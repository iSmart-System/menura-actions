# =============================================================================
# Exemplo: CI para projeto Bun no GitLab
# =============================================================================
# Este exemplo mostra como usar os templates do m3nura/pipelines com Bun.
# Copie este arquivo para a raiz do seu projeto como .gitlab-ci.yml
# =============================================================================

# Workflow rules: controla quando a pipeline é executada
workflow:
  rules:
    # Permitir MRs (Merge Requests)
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
    # Evitar duplicação se já existe MR aberto para a branch
    - if: '$CI_COMMIT_BRANCH && $CI_OPEN_MERGE_REQUESTS'
      when: never
    # BLOQUEAR commits diretos em sandbox e main (usar workflow de release!)
    - if: '$CI_COMMIT_BRANCH == "sandbox" || $CI_COMMIT_BRANCH == "main"'
      when: never
    # Permitir outras branches (feature, fix, etc.)
    - if: '$CI_COMMIT_BRANCH'

include:
  # Include DIRETO do arquivo específico para Bun
  - project: 'm3nura/pipelines'
    ref: main
    file: '.gitlab/ci/codebase-ci-bun.yml'

# Definir stages
stages:
  - test
  - build

# Definir variáveis do projeto
variables:
  BUN_VERSION: "latest"
  ARTIFACT_PATH: "dist"
  ARTIFACT_NAME: "meu-app-bun"

# Job de lint (estende template do arquivo incluído)
lint:
  extends: .bun-lint

# Job de testes (estende template do arquivo incluído)
test:
  extends: .bun-test

# Job de build (estende template do arquivo incluído)
build:
  extends: .bun-build
